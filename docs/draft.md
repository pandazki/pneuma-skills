# Pneuma Skills â€” éœ€æ±‚æ–‡æ¡£

> **"pneuma"** â€” å¸Œè…Šè¯­ Ï€Î½Îµá¿¦Î¼Î±ï¼Œæ„ä¸ºçµé­‚ã€æ°”æ¯ã€ç”Ÿå‘½åŠ›ã€‚ä¹Ÿè°éŸ³"ç‰›é©¬"ã€‚
>
> **ç‰ˆæœ¬**: v0.3 Draft  
> **ä½œè€…**: Pandazki  
> **æ—¥æœŸ**: 2026-02-26  
> **çŠ¶æ€**: æ¶æ„è®¾è®¡é˜¶æ®µ

---

## 1. é¡¹ç›®æ¦‚è¿°

### 1.1 ä¸€å¥è¯å®šä¹‰

**Pneuma Skills æ˜¯ä¸€ä¸ªè®© Code Agent å¯¹ HTML-based å†…å®¹åšæ‰€è§å³æ‰€å¾—ç¼–è¾‘çš„å¼€æºæ¡†æ¶ã€‚**

### 1.2 æ ¸å¿ƒæ´å¯Ÿ

å¸‚é¢ä¸Šå¤§é‡ AI å†…å®¹ç”Ÿæˆäº§å“çš„åº•å±‚é€»è¾‘æ˜¯ç›¸åŒçš„ï¼š

1. æœ‰ä¸€ç§ **HTML-based å†…å®¹**ï¼ˆslidesã€æ–‡æ¡£ã€æ€ç»´å¯¼å›¾ã€æµ·æŠ¥...ï¼‰
2. éœ€è¦ä¸€ä¸ª **Code Agent** æ¥ç”Ÿæˆå’Œç¼–è¾‘å®ƒï¼ˆClaude Codeã€Codexã€è‡ªç ” Agent...ï¼‰
3. éœ€è¦ä¸€ä¸ª **æ‰€è§å³æ‰€å¾—çš„ç¼–è¾‘å™¨**ï¼Œè®©ç”¨æˆ·èƒ½é¢„è§ˆã€é€‰ä¸­ã€æŒ‡ä»¤ä¿®æ”¹

è¿™ä¸‰è€…çš„ç»„åˆæ¨¡å¼æ˜¯å›ºå®šçš„ï¼Œä½†ç›®å‰æ¯ä¸ªäº§å“éƒ½åœ¨é‡å¤é€ è½®å­ã€‚Pneuma Skills æŠŠè¿™ä¸ªæ¨¡å¼æŠ½è±¡æˆæ¡†æ¶ï¼š

```
Pneuma Skills = Content Mode Ã— Code Agent Backend Ã— WYSIWYG Editor Shell
```

### 1.3 æ¶æ„åˆ†å±‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Content Modes (å¯æ’æ‹”)                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Slide   â”‚ â”‚   Doc    â”‚ â”‚ Mindmap  â”‚ â”‚  Canvas  â”‚   â”‚
â”‚  â”‚  Mode    â”‚ â”‚   Mode   â”‚ â”‚  Mode    â”‚ â”‚  Mode    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                     Editor Shell (é€šç”¨)                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Web UI: å†…å®¹é¢„è§ˆ + å…ƒç´ é€‰ä¸­ + å¯¹è¯è¾“å…¥ +         â”‚   â”‚
â”‚  â”‚         streaming å±•ç¤º + tool å®¡æ‰¹                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                     Agent Bridge (é€šç”¨)                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Node Server: spawn agent + WebSocket æ¶ˆæ¯è·¯ç”± +  â”‚   â”‚
â”‚  â”‚              file watcher + session ç®¡ç†          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                  Code Agent Backends (å¯æ’æ‹”)              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Claude  â”‚ â”‚  Codex   â”‚ â”‚  Custom  â”‚ â”‚  ...     â”‚   â”‚
â”‚  â”‚  Code    â”‚ â”‚  CLI     â”‚ â”‚  Agent   â”‚ â”‚          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.4 ä¸¤ä¸ªå¯æ’æ‹”ç»´åº¦

#### Content Mode â€” "ç¼–è¾‘ä»€ä¹ˆ"

æ¯ä¸ª Mode å®šä¹‰äº†ä¸€ç§ HTML-based å†…å®¹ç±»å‹çš„ç¼–è¾‘ä½“éªŒï¼š

| Mode | å†…å®¹ç±»å‹ | ç¼–è¾‘å™¨ç‰¹å¾ | MVP |
|------|----------|-----------|-----|
| **Slide Mode** | æ¼”ç¤ºæ–‡ç¨¿ | å·¦ä¾§å¤§çº² + å³ä¾§å•é¡µé¢„è§ˆ + é¡µé¢å¯¼èˆª | âœ… |
| Doc Mode | é•¿æ–‡æ¡£ | è¿ç»­æ»šåŠ¨é¢„è§ˆ + æ®µè½çº§é€‰ä¸­ | åç»­ |
| Mindmap Mode | æ€ç»´å¯¼å›¾ | èŠ‚ç‚¹æ ‘é¢„è§ˆ + èŠ‚ç‚¹é€‰ä¸­/å±•å¼€ | åç»­ |
| Canvas Mode | è‡ªç”±ç”»å¸ƒï¼ˆæµ·æŠ¥/å¡ç‰‡ï¼‰ | æ— é™ç”»å¸ƒ + å…ƒç´ è‡ªç”±é€‰ä¸­ | åç»­ |

ä¸€ä¸ª Content Mode éœ€è¦æä¾›ï¼š
- **Renderer** â€” å¦‚ä½•æ¸²æŸ“è¿™ç§å†…å®¹ï¼ˆiframeï¼Ÿè‡ªå®šä¹‰ç»„ä»¶ï¼Ÿï¼‰
- **Selector** â€” ç”¨æˆ·å¦‚ä½•é€‰ä¸­å†…å®¹ä¸­çš„å…ƒç´ ï¼ˆç²’åº¦ã€é«˜äº®æ–¹å¼ï¼‰
- **Outline/Navigator** â€” å†…å®¹çš„ç»“æ„åŒ–å¯¼èˆªï¼ˆå¤§çº²ã€é¡µé¢åˆ—è¡¨ã€èŠ‚ç‚¹æ ‘ï¼‰
- **Skill** â€” ç»™ Code Agent çš„é¢†åŸŸ promptï¼ˆCLAUDE.md / system promptï¼‰
- **File Convention** â€” å†…å®¹çš„æ–‡ä»¶ç»„ç»‡çº¦å®šï¼ˆmanifest.json + åˆ†é¡µ HTML ç­‰ï¼‰

#### Code Agent Backend â€” "è°æ¥ç¼–è¾‘"

æ¯ä¸ª Backend å°è£…äº†ä¸€ç§ Code Agent çš„å¯åŠ¨å’Œé€šä¿¡æ–¹å¼ï¼š

| Backend | å¯åŠ¨æ–¹å¼ | é€šä¿¡åè®® | è®¡è´¹ | MVP |
|---------|---------|---------|------|-----|
| **Claude Code** | `claude --sdk-url ws://...` | NDJSON over WebSocket | Max è®¢é˜… | âœ… |
| Codex CLI | `codex --sdk-url ws://...`ï¼ˆå¾…éªŒè¯ï¼‰ | ç±»ä¼¼ NDJSON | Codex è®¢é˜… | åç»­ |
| Custom Agent | è‡ªå®šä¹‰ spawn | è‡ªå®šä¹‰åè®®é€‚é… | è‡ªå®šä¹‰ | åç»­ |

ä¸€ä¸ª Code Agent Backend éœ€è¦å®ç°ï¼š
- **Spawner** â€” å¦‚ä½•å¯åŠ¨ agent è¿›ç¨‹
- **Protocol Adapter** â€” å°†æ¡†æ¶çš„æ ‡å‡†æ¶ˆæ¯æ ¼å¼è½¬æ¢ä¸º agent çš„åŸç”Ÿåè®®
- **Permission Handler** â€” å¤„ç† agent çš„ tool å®¡æ‰¹æµç¨‹
- **Session Manager** â€” session ç”Ÿå‘½å‘¨æœŸï¼ˆå¯åŠ¨/æ¢å¤/é”€æ¯ï¼‰

### 1.5 ç›®æ ‡ç”¨æˆ·

- é¦–è¦ï¼š**å†…éƒ¨å›¢é˜Ÿ** å’Œ **å¼€å‘è€…ç”¨æˆ·**
- å‰ææ¡ä»¶ï¼šNode.js/Bun + è‡³å°‘ä¸€ä¸ª Code Agent CLIï¼ˆå¦‚ Claude Code + Max è®¢é˜…ï¼‰
- é•¿æœŸï¼šä»»ä½•æƒ³ç”¨ Code Agent åšå†…å®¹ç¼–è¾‘çš„å¼€å‘è€…

---

## 2. ç³»ç»Ÿæ¶æ„

### 2.1 æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       ç”¨æˆ·æµè§ˆå™¨                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                   Editor Shell                       â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â”‚
â”‚  â”‚  â”‚         Content Mode Renderer                â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  (ç”±å½“å‰ mode å†³å®š: slide/doc/mindmap/...)   â”‚    â”‚  â”‚
â”‚  â”‚  â”‚                                              â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ Navigator â”‚  â”‚   Content Preview      â”‚   â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ (å¤§çº²/    â”‚  â”‚   (iframeæ¸²æŸ“å®é™…å†…å®¹)  â”‚   â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  é¡µé¢åˆ—è¡¨/ â”‚  â”‚                        â”‚   â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  èŠ‚ç‚¹æ ‘)  â”‚  â”‚   [å¯é€‰ä¸­å…ƒç´ , é«˜äº®]    â”‚   â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â”‚
â”‚  â”‚  â”‚  ğŸ¤– Agent: æ­£åœ¨ä¿®æ”¹ç¬¬3é¡µ...                   â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  ğŸ’¬ [è¾“å…¥ä¿®æ”¹æŒ‡ä»¤...]                 [å‘é€]  â”‚    â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚ WebSocket (JSON)
                          â”‚ /ws/browser/:sessionId
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Agent Bridge (Node Server)               â”‚
â”‚                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Static File   â”‚  â”‚ Message      â”‚  â”‚ File Watcher   â”‚ â”‚
â”‚  â”‚ Server        â”‚  â”‚ Router       â”‚  â”‚                â”‚ â”‚
â”‚  â”‚               â”‚  â”‚              â”‚  â”‚ ç›‘å¬å†…å®¹æ–‡ä»¶    â”‚ â”‚
â”‚  â”‚ serve UI +    â”‚  â”‚ æ ‡å‡†æ¶ˆæ¯æ ¼å¼  â”‚  â”‚ å˜æ›´ â†’ æ¨é€    â”‚ â”‚
â”‚  â”‚ content files â”‚  â”‚ â†• åè®®é€‚é…    â”‚  â”‚ é¢„è§ˆæ›´æ–°       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                           â”‚                               â”‚
â”‚     Protocol Adapter      â”‚  (ç”±å½“å‰ backend å†³å®š)        â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚     â”‚ Claude Code: NDJSON over WebSocket           â”‚      â”‚
â”‚     â”‚ Codex:       (ç±»ä¼¼åè®®, å¾…é€‚é…)               â”‚      â”‚
â”‚     â”‚ Custom:      è‡ªå®šä¹‰åè®®                       â”‚      â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚ spawn + åè®®è¿æ¥
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Code Agent (Headless å­è¿›ç¨‹)                    â”‚
â”‚                                                           â”‚
â”‚  ç¤ºä¾‹ (Claude Code):                                       â”‚
â”‚  claude --sdk-url ws://localhost:PORT/ws/cli/SESSION       â”‚
â”‚          --print --output-format stream-json               â”‚
â”‚                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Content Mode Skill (CLAUDE.md / system prompt)      â”‚  â”‚
â”‚  â”‚  - å†…å®¹ç”Ÿæˆæœ€ä½³å®è·µ                                    â”‚  â”‚
â”‚  â”‚  - æ–‡ä»¶ç»„ç»‡çº¦å®š                                        â”‚  â”‚
â”‚  â”‚  - æ¨¡æ¿ / ä¸»é¢˜ç³»ç»Ÿ                                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                           â”‚
â”‚  ğŸ“‚ å·¥ä½œç›®å½•: å†…å®¹æºæ–‡ä»¶ (HTML/CSS/JS)                      â”‚
â”‚  ğŸ’³ ä½¿ç”¨ç”¨æˆ·è‡ªå·±çš„ Agent è®¢é˜…ï¼Œæ— é¢å¤–æˆæœ¬                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æ ‡å‡†æ¶ˆæ¯æ ¼å¼

æ¡†æ¶å®šä¹‰ä¸€å¥—ä¸ Agent æ— å…³çš„æ ‡å‡†æ¶ˆæ¯æ ¼å¼ï¼ŒProtocol Adapter è´Ÿè´£åŒå‘è½¬æ¢ï¼š

```typescript
// === æ¡†æ¶æ ‡å‡†æ¶ˆæ¯ (Framework â†” Browser) ===

// ç”¨æˆ·å‘é€ç¼–è¾‘æŒ‡ä»¤
interface UserMessage {
  type: "user_message";
  content: string;                    // ç”¨æˆ·è¾“å…¥çš„è‡ªç„¶è¯­è¨€æŒ‡ä»¤
  uiContext: {                        // Editor Shell è‡ªåŠ¨é™„åŠ 
    mode: "slide" | "doc" | "mindmap" | "canvas";
    currentView: string;              // mode-specific: slide index / scroll position / node id
    selectedElement?: {
      selector: string;               // CSS selector
      tagName: string;
      textContent: string;
      // ...mode-specific æ‰©å±•
    };
  };
}

// Agent streaming å“åº”
interface AgentResponse {
  type: "agent_response";
  subtype: "text" | "tool_use" | "tool_result" | "thinking" | "complete";
  content: string;
}

// Agent è¯·æ±‚ tool æƒé™
interface PermissionRequest {
  type: "permission_request";
  tool: string;
  input: Record<string, any>;
  description: string;
}

// ç”¨æˆ·å›å¤æƒé™
interface PermissionResponse {
  type: "permission_response";
  requestId: string;
  allowed: boolean;
  modifiedInput?: Record<string, any>;  // å¯ç¼–è¾‘åæ”¾è¡Œ
}

// å†…å®¹æ–‡ä»¶æ›´æ–°
interface ContentUpdate {
  type: "content_update";
  files: Array<{ path: string; action: "created" | "modified" | "deleted" }>;
}
```

### 2.3 Content Mode æ¥å£

```typescript
interface ContentMode {
  name: string;                         // "slide" | "doc" | "mindmap" | "canvas"

  // --- UI ç»„ä»¶ ---
  NavigatorComponent: React.FC;         // å·¦ä¾§å¯¼èˆªç»„ä»¶
  PreviewComponent: React.FC;           // å³ä¾§é¢„è§ˆç»„ä»¶
  SelectorBehavior: ElementSelector;    // å…ƒç´ é€‰ä¸­ç­–ç•¥

  // --- å†…å®¹çº¦å®š ---
  fileConvention: {
    manifestFile: string;               // e.g. "manifest.json"
    contentDir: string;                 // e.g. "slides/"
    assetDir: string;                   // e.g. "assets/"
  };

  // --- Skill å®‰è£… ---
  skill: {
    sourceDir: string;                  // skill æºæ–‡ä»¶ç›®å½• (æ¡†æ¶å†…)
    installDir: string;                 // å®‰è£…ç›®æ ‡: ".claude/skills/pneuma-slide"
    claudeMdSnippet: string;            // æ³¨å…¥ CLAUDE.md çš„å†…å®¹ç‰‡æ®µ
    version: string;                    // skill ç‰ˆæœ¬å·ï¼Œç”¨äºå‡çº§æ£€æµ‹
  };

  // --- Skill å†…å®¹ ---
  getTemplates(): Template[];           // å¯ç”¨æ¨¡æ¿åˆ—è¡¨ (ä» skill/templates/ è¯»å–)

  // --- UI ä¸Šä¸‹æ–‡ ---
  extractUIContext(state: EditorState): UIContext;
}
```

### 2.4 Agent Backend æ¥å£

```typescript
interface AgentBackend {
  name: string;                         // "claude-code" | "codex" | "custom"

  // --- ç”Ÿå‘½å‘¨æœŸ ---
  spawn(options: SpawnOptions): Promise<AgentProcess>;
  resume(sessionId: string): Promise<AgentProcess>;
  kill(sessionId: string): Promise<void>;

  // --- åè®®é€‚é… ---
  adaptOutgoing(msg: UserMessage): string;        // æ ‡å‡†æ¶ˆæ¯ â†’ agent åŸç”Ÿæ ¼å¼
  adaptIncoming(raw: string): AgentResponse;      // agent åŸç”Ÿæ ¼å¼ â†’ æ ‡å‡†æ¶ˆæ¯

  // --- èƒ½åŠ›å£°æ˜ ---
  capabilities: {
    streaming: boolean;
    permissions: boolean;
    resume: boolean;
    subagents: boolean;
  };
}
```

---

## 3. MVP: Slide Mode + Claude Code

### 3.1 èŒƒå›´

```bash
pneuma slide                    # å¯åŠ¨ Slide Mode + Claude Code (é»˜è®¤)
pneuma slide --agent codex      # å¯åŠ¨ Slide Mode + Codex (æœªæ¥)
pneuma doc                      # å¯åŠ¨ Doc Mode (æœªæ¥)
pneuma slide --port 3210 --workspace ./my-deck
```

MVP = **Slide Mode** Ã— **Claude Code Backend**

### 3.2 å¯åŠ¨æµç¨‹

```
$ pneuma slide --workspace ./my-deck

1. è§£æå‚æ•°: mode=slide, agent=claude-code, workspace=./my-deck
2. åŠ è½½ Slide Mode é…ç½® + Claude Code Backend
3. ğŸ“¦ å®‰è£… Slide Mode Skill åˆ°å·¥ä½œç›®å½•:
   â†’ ./my-deck/.claude/skills/pneuma-slide/
   åŒ…å« SKILL.md, templates/, references/, scripts/ ç­‰
   â†’ ./my-deck/CLAUDE.md è¿½åŠ å¼•ç”¨ skill çš„æŒ‡ä»¤
4. å¯åŠ¨ Node Server (HTTP + WebSocket)
5. spawn headless Claude Code:
   claude --sdk-url ws://localhost:3210/ws/cli/<uuid> \
          --print --output-format stream-json
   â†’ Claude Code å¯åŠ¨æ—¶è‡ªåŠ¨åŠ è½½ .claude/ ä¸‹çš„ skill
6. ç­‰å¾… CLI WebSocket è¿æ¥
7. æ‰“å¼€æµè§ˆå™¨: http://localhost:3210

ç”¨æˆ·çœ‹åˆ°ç©ºç™½çš„ Slide Editorï¼Œè¾“å…¥ï¼š
ğŸ’¬ "åšä¸€ä¸ªå…³äº AI Agent è¶‹åŠ¿çš„ PPTï¼Œ10é¡µï¼Œæš—è‰²ä¸»é¢˜"
â†’ æ¶ˆæ¯è·¯ç”±åˆ° headless Claude Code
â†’ Claude Code è°ƒç”¨ Slide Skill ä¸­çš„æœ€ä½³å®è·µå’Œæ¨¡æ¿
â†’ streaming å“åº”å®æ—¶æ˜¾ç¤º
â†’ slide æ–‡ä»¶ç”Ÿæˆ â†’ file watcher â†’ é¢„è§ˆåŠ è½½
```

### 3.3 ç¼–è¾‘è¿­ä»£æµç¨‹

```
[Editor Shell]              [Agent Bridge]             [Claude Code]
   â”‚                             â”‚                          â”‚
   â”‚ ç”¨æˆ·é€‰ä¸­ç¬¬3é¡µæ ‡é¢˜             â”‚                          â”‚
   â”‚ è¾“å…¥: "æ”¹å¤§ä¸€ç‚¹, åŠ å‰¯æ ‡é¢˜"    â”‚                          â”‚
   â”‚ â”€â”€ WebSocket (JSON) â”€â”€â”€â”€â”€â”€>â”‚                          â”‚
   â”‚                             â”‚ æ³¨å…¥ UI ä¸Šä¸‹æ–‡:           â”‚
   â”‚                             â”‚ "[å½“å‰: ç¬¬3é¡µ, é€‰ä¸­:      â”‚
   â”‚                             â”‚  h1.title 'æŠ€æœ¯æ–¹æ¡ˆ']     â”‚
   â”‚                             â”‚  æ”¹å¤§ä¸€ç‚¹, åŠ å‰¯æ ‡é¢˜"      â”‚
   â”‚                             â”‚ â”€â”€ NDJSON â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚                             â”‚                          â”‚
   â”‚                             â”‚<â”€â”€ streaming tokens â”€â”€â”€â”€â”€â”‚
   â”‚<â”€â”€ streaming è½¬å‘ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                          â”‚
   â”‚ å®æ—¶çœ‹åˆ° Claude çš„æ€è€ƒ       â”‚                          â”‚
   â”‚                             â”‚                          â”‚
   â”‚                             â”‚    ä¿®æ”¹ slide-03.html    â”‚
   â”‚                             â”‚<â”€â”€ file watcher â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
   â”‚<â”€â”€ content_update â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                          â”‚
   â”‚                             â”‚                          â”‚
   â”‚ é¢„è§ˆå®æ—¶æ›´æ–° âœ…              â”‚                          â”‚
```

### 3.4 Skill å®‰è£…æœºåˆ¶

Pneuma å¯åŠ¨æ—¶ï¼Œä¼šæ ¹æ® Content Mode å°†å¯¹åº”çš„ **Claude Code Skill** å®‰è£…åˆ°å·¥ä½œç›®å½•ä¸‹ã€‚è¿™æ˜¯è®© Code Agent å…·å¤‡é¢†åŸŸèƒ½åŠ›çš„å…³é”®æ­¥éª¤ã€‚

#### å®‰è£…æµç¨‹

```
pneuma slide --workspace ./my-deck
       â”‚
       â–¼
  æ£€æµ‹ ./my-deck/.claude/skills/pneuma-slide/ æ˜¯å¦å­˜åœ¨
       â”‚
       â”œâ”€â”€ ä¸å­˜åœ¨ â†’ ä» modes/slide/skill/ å¤åˆ¶å®Œæ•´ skill åŒ…
       â”‚            â†’ åœ¨ CLAUDE.md ä¸­è¿½åŠ  skill å¼•ç”¨
       â”‚
       â””â”€â”€ å·²å­˜åœ¨ â†’ æ£€æŸ¥ç‰ˆæœ¬ï¼Œæç¤ºæ˜¯å¦æ›´æ–°
```

#### å®‰è£…åçš„å·¥ä½œç›®å½•ç»“æ„

```
my-deck/
â”œâ”€â”€ CLAUDE.md                           # é¡¹ç›®çº§ prompt (pneuma è‡ªåŠ¨ç®¡ç†)
â”œâ”€â”€ .claude/
â”‚   â””â”€â”€ skills/
â”‚       â””â”€â”€ pneuma-slide/               # â† Slide Mode Skill (å®Œæ•´ skill åŒ…)
â”‚           â”œâ”€â”€ SKILL.md                 # Skill å…¥å£ï¼šç”Ÿæˆè§„èŒƒ + ç¼–è¾‘åè®®
â”‚           â”œâ”€â”€ templates/
â”‚           â”‚   â”œâ”€â”€ themes/
â”‚           â”‚   â”‚   â”œâ”€â”€ minimal-light.css
â”‚           â”‚   â”‚   â”œâ”€â”€ minimal-dark.css
â”‚           â”‚   â”‚   â””â”€â”€ corporate.css
â”‚           â”‚   â””â”€â”€ layouts/
â”‚           â”‚       â”œâ”€â”€ title.html
â”‚           â”‚       â”œâ”€â”€ content.html
â”‚           â”‚       â”œâ”€â”€ two-column.html
â”‚           â”‚       â””â”€â”€ chart.html
â”‚           â”œâ”€â”€ references/
â”‚           â”‚   â”œâ”€â”€ slide-codegen-guide.md   # HTML slide ä»£ç ç”Ÿæˆè¯¦ç»†æŒ‡å—
â”‚           â”‚   â”œâ”€â”€ design-principles.md     # æ’ç‰ˆ/é…è‰²/å­—ä½“æœ€ä½³å®è·µ
â”‚           â”‚   â””â”€â”€ chart-patterns.md        # æ•°æ®å¯è§†åŒ–æ¨¡å¼
â”‚           â””â”€â”€ scripts/
â”‚               â”œâ”€â”€ validate-manifest.js     # æ ¡éªŒ manifest.json å®Œæ•´æ€§
â”‚               â””â”€â”€ export-pdf.js            # PDF å¯¼å‡ºè¾…åŠ©è„šæœ¬
â”‚
â”œâ”€â”€ manifest.json                       # slide å…ƒæ•°æ®
â”œâ”€â”€ slides/
â”‚   â”œâ”€â”€ slide-01.html
â”‚   â””â”€â”€ ...
â”œâ”€â”€ assets/
â”œâ”€â”€ theme.css
â””â”€â”€ index.html
```

#### CLAUDE.md è‡ªåŠ¨æ³¨å…¥å†…å®¹

Pneuma åœ¨å®‰è£… skill æ—¶ï¼Œä¼šåœ¨å·¥ä½œç›®å½•çš„ `CLAUDE.md` ä¸­è¿½åŠ ï¼š

```markdown
## Pneuma Slide Mode

ä½ æ­£åœ¨ä¸€ä¸ª Pneuma Slide ç¼–è¾‘ç¯å¢ƒä¸­å·¥ä½œã€‚
ç”¨æˆ·é€šè¿‡å¯è§†åŒ–ç¼–è¾‘å™¨ä¸ä½ äº¤äº’ï¼Œæ¶ˆæ¯ä¸­å¯èƒ½åŒ…å« [Context: ...] å‰ç¼€ï¼Œ
è¡¨ç¤ºç”¨æˆ·å½“å‰æŸ¥çœ‹çš„é¡µé¢å’Œé€‰ä¸­çš„å…ƒç´ ã€‚

è¯¦ç»†çš„ slide ç”Ÿæˆè§„èŒƒå’Œæ¨¡æ¿è¯·å‚è€ƒ skill:
.claude/skills/pneuma-slide/SKILL.md

### å…³é”®çº¦å®š
- æ¯é¡µ slide ä¸€ä¸ªç‹¬ç«‹ HTML æ–‡ä»¶: slides/slide-XX.html
- ä¸»é¢˜æ ·å¼: theme.css
- å…ƒæ•°æ®: manifest.json (ä¿®æ”¹ slide åå¿…é¡»åŒæ­¥æ›´æ–°)
- æ¨¡æ¿ç›®å½•: .claude/skills/pneuma-slide/templates/
```

#### ä¸åŒ Mode å®‰è£…ä¸åŒ Skill

| Content Mode | Skill åŒ…è·¯å¾„ | å®‰è£…ä½ç½® | æ ¸å¿ƒèƒ½åŠ› |
|-------------|-------------|---------|---------|
| **Slide** | `modes/slide/skill/` | `.claude/skills/pneuma-slide/` | slide ç”Ÿæˆè§„èŒƒã€ä¸»é¢˜ã€å¸ƒå±€æ¨¡æ¿ã€å¯¼å‡ºè„šæœ¬ |
| Doc | `modes/doc/skill/` | `.claude/skills/pneuma-doc/` | æ–‡æ¡£ç»“æ„è§„èŒƒã€æ®µè½æ ·å¼ã€ç›®å½•ç”Ÿæˆ |
| Mindmap | `modes/mindmap/skill/` | `.claude/skills/pneuma-mindmap/` | èŠ‚ç‚¹ç»“æ„è§„èŒƒã€å¸ƒå±€ç®—æ³•æç¤ºã€SVG ç”Ÿæˆ |
| Canvas | `modes/canvas/skill/` | `.claude/skills/pneuma-canvas/` | è‡ªç”±å¸ƒå±€è§„èŒƒã€å…ƒç´ å®šä½çº¦å®šã€å“åº”å¼ç­–ç•¥ |

è¿™æ ·åšçš„å¥½å¤„ï¼š
1. **Skill å’Œ Claude Code åŸç”Ÿæœºåˆ¶å¯¹é½** â€” åˆ©ç”¨ `.claude/skills/` ç›®å½•ï¼ŒClaude Code ä¼šè‡ªåŠ¨å‘ç°å’ŒåŠ è½½
2. **æ¯ä¸ª Mode çš„é¢†åŸŸçŸ¥è¯†å®Œå…¨ç‹¬ç«‹** â€” åˆ‡æ¢ mode å°±æ˜¯åˆ‡æ¢ skill
3. **ç”¨æˆ·å¯ä»¥è‡ªå®šä¹‰/æ‰©å±• skill** â€” ä¿®æ”¹å®‰è£…åçš„ skill æ–‡ä»¶å³å¯è¦†ç›–é»˜è®¤è¡Œä¸º
4. **æ”¯æŒ skill ç‰ˆæœ¬ç®¡ç†** â€” æ¡†æ¶æ›´æ–°æ—¶å¯ä»¥æç¤ºç”¨æˆ·å‡çº§ skill

### 3.5 Slide Mode ç¼–è¾‘å™¨è®¾è®¡

#### ç¼–è¾‘å™¨ç•Œé¢

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [ğŸ“Š My Deck]           [â–¶ æ¼”ç¤º] [ğŸ¨ ä¸»é¢˜] [â†— å¯¼å‡º] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              â”‚                                      â”‚
â”‚  â–  1. å°é¢   â”‚                                      â”‚
â”‚    2. èƒŒæ™¯   â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚    3. æ–¹æ¡ˆ   â”‚      â”‚                          â”‚    â”‚
â”‚    4. æ•°æ®   â”‚      â”‚   Slide 3: æŠ€æœ¯æ–¹æ¡ˆ       â”‚    â”‚
â”‚    5. æ¡ˆä¾‹   â”‚      â”‚                          â”‚    â”‚
â”‚    6. æ€»ç»“   â”‚      â”‚   [h1 æ ‡é¢˜ â€” å·²é€‰ä¸­ ğŸ”µ]   â”‚    â”‚
â”‚              â”‚      â”‚   æ­£æ–‡å†…å®¹...             â”‚    â”‚
â”‚              â”‚      â”‚   å›¾è¡¨åŒºåŸŸ               â”‚    â”‚
â”‚  [+ æ–°é¡µ]    â”‚      â”‚                          â”‚    â”‚
â”‚              â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚              â”‚                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ¤– Claude: å¥½çš„ï¼Œæˆ‘æ¥æŠŠæ ‡é¢˜å­—å·è°ƒå¤§å¹¶æ·»åŠ å‰¯æ ‡é¢˜...    â”‚
â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘                           â”‚
â”‚  ğŸ’¬ [æè¿°ä½ æƒ³è¦çš„ä¿®æ”¹...]                     [å‘é€]  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Slide Mode æ–‡ä»¶çº¦å®š

è¯¦è§ [3.4 Skill å®‰è£…æœºåˆ¶](#34-skill-å®‰è£…æœºåˆ¶) ä¸­çš„å®Œæ•´ç›®å½•ç»“æ„ã€‚æ ¸å¿ƒçº¦å®šï¼š

```
workspace/
â”œâ”€â”€ CLAUDE.md                       # é¡¹ç›® prompt (pneuma è‡ªåŠ¨æ³¨å…¥ skill å¼•ç”¨)
â”œâ”€â”€ .claude/skills/pneuma-slide/    # Skill åŒ… (pneuma è‡ªåŠ¨å®‰è£…)
â”œâ”€â”€ manifest.json                   # slide å…ƒæ•°æ® (æ ‡é¢˜/é¡ºåº/ä¸»é¢˜)
â”œâ”€â”€ slides/                         # æ¯é¡µä¸€ä¸ª HTML æ–‡ä»¶
â”œâ”€â”€ assets/                         # å›¾ç‰‡/å›¾è¡¨ç­‰èµ„äº§
â”œâ”€â”€ theme.css                       # å½“å‰ä¸»é¢˜æ ·å¼
â””â”€â”€ index.html                      # æ¼”ç¤ºæ¨¡å¼å…¥å£
```

#### manifest.json

```json
{
  "title": "AI Agent å‘å±•è¶‹åŠ¿",
  "mode": "slide",
  "theme": "minimal-dark",
  "slides": [
    { "file": "slides/slide-01.html", "title": "å°é¢", "notes": "" },
    { "file": "slides/slide-02.html", "title": "èƒŒæ™¯", "notes": "..." },
    { "file": "slides/slide-03.html", "title": "æŠ€æœ¯æ–¹æ¡ˆ", "notes": "..." }
  ]
}
```

#### Slide Mode Skill (SKILL.md æ ¸å¿ƒå†…å®¹æ‘˜è¦)

å®Œæ•´ skill åœ¨ `modes/slide/skill/` ä¸‹ï¼Œå¯åŠ¨æ—¶è‡ªåŠ¨å®‰è£…åˆ° `workspace/.claude/skills/pneuma-slide/`ã€‚

SKILL.md æ ¸å¿ƒæŒ‡ä»¤ï¼š

```markdown
# Pneuma Slide Skill

## ä½ çš„è§’è‰²
ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„ PPT è®¾è®¡å¸ˆå’Œå¼€å‘è€…ã€‚ç”¨æˆ·é€šè¿‡ Pneuma å¯è§†åŒ–ç¼–è¾‘å™¨ä¸ä½ äº¤äº’ã€‚

## ç”¨æˆ·ä¸Šä¸‹æ–‡
ç”¨æˆ·æ¶ˆæ¯å¯èƒ½åŒ…å« [Context: ...] å‰ç¼€ï¼Œå‘Šè¯‰ä½ å½“å‰é¡µé¢å’Œé€‰ä¸­å…ƒç´ ã€‚
è¯·ç»“åˆä¸Šä¸‹æ–‡ç†è§£ä¿®æ”¹æ„å›¾ã€‚ä¾‹å¦‚:
  [Context: Slide 3, selected: h1.title "æŠ€æœ¯æ–¹æ¡ˆ"] æ”¹å¤§ä¸€ç‚¹
  â†’ ä½ åº”è¯¥ä¿®æ”¹ slides/slide-03.html ä¸­çš„ h1 æ ‡é¢˜å­—å·

## æ–‡ä»¶çº¦å®š
- æ¯é¡µ: slides/slide-XX.html
- ä¸»é¢˜: theme.css
- å…ƒæ•°æ®: manifest.json (ä¿®æ”¹åå¿…é¡»åŒæ­¥)
- æ¨¡æ¿å‚è€ƒ: æœ¬ skill çš„ templates/ ç›®å½•

## è®¾è®¡åŸåˆ™
- æ’ç‰ˆæ•´é½ï¼Œç•™ç™½å……åˆ†ï¼Œæ¯é¡µèšç„¦ä¸€ä¸ªä¸»é¢˜
- CSS Grid/Flexbox å¸ƒå±€ï¼Œå›¾è¡¨ä¼˜å…ˆ SVG
- è¯¦ç»†æŒ‡å—è§ references/slide-codegen-guide.md
```

### 3.5 Claude Code Backend è¯¦ç»†è®¾è®¡

#### é€šä¿¡åè®®

å®Œå…¨å‚è€ƒ [The-Vibe-Company/companion](https://github.com/The-Vibe-Company/companion) çš„é€†å‘å·¥ç¨‹æ–¹æ¡ˆï¼š

- åè®®æ–‡æ¡£ï¼š`WEBSOCKET_PROTOCOL_REVERSED.md`
- ä¼ è¾“æ ¼å¼ï¼šNDJSON (Newline-Delimited JSON) over WebSocket
- å¯åŠ¨å‘½ä»¤ï¼š`claude --sdk-url ws://localhost:PORT/ws/cli/SESSION_ID --print --output-format stream-json`
- ä½¿ç”¨ç”¨æˆ·çš„ **Claude Max è®¢é˜…**ï¼Œæ— éœ€ API key

#### MVP éœ€å®ç°çš„æ¶ˆæ¯ç±»å‹

| æ¶ˆæ¯ç±»å‹ | æ–¹å‘ | è¯´æ˜ |
|---------|------|------|
| `initialize` | Server â†’ CLI | ä¼šè¯åˆå§‹åŒ– |
| user prompt | Server â†’ CLI | å‘é€ç”¨æˆ·æŒ‡ä»¤ï¼ˆèåˆ UI ä¸Šä¸‹æ–‡ï¼‰ |
| streaming tokens | CLI â†’ Server | token-by-token å“åº” |
| `can_use_tool` | CLI â†’ Server | tool æƒé™è¯·æ±‚ |
| tool permission response | Server â†’ CLI | ç”¨æˆ·å®¡æ‰¹ç»“æœ |
| `result` | CLI â†’ Server | ä»»åŠ¡å®Œæˆ |

---

## 4. é¡¹ç›®ç»“æ„

```
pneuma-skills/
â”œâ”€â”€ package.json                    # monorepo or single package
â”œâ”€â”€ bin/
â”‚   â””â”€â”€ pneuma.js                   # CLI: pneuma slide / pneuma doc / ...
â”‚
â”œâ”€â”€ core/                           # æ¡†æ¶æ ¸å¿ƒ (Agent-agnostic, Mode-agnostic)
â”‚   â”œâ”€â”€ server/
â”‚   â”‚   â”œâ”€â”€ index.ts                # HTTP + WebSocket server
â”‚   â”‚   â”œâ”€â”€ message-router.ts       # æ ‡å‡†æ¶ˆæ¯è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ file-watcher.ts         # æ–‡ä»¶å˜æ›´ç›‘å¬ + æ¨é€
â”‚   â”‚   â”œâ”€â”€ session-manager.ts      # session ç”Ÿå‘½å‘¨æœŸ
â”‚   â”‚   â””â”€â”€ skill-installer.ts      # Skill å®‰è£…/æ›´æ–°: mode.skill â†’ workspace/.claude/skills/
â”‚   â”œâ”€â”€ types/
â”‚   â”‚   â”œâ”€â”€ messages.ts             # æ ‡å‡†æ¶ˆæ¯ç±»å‹å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ content-mode.ts         # ContentMode æ¥å£
â”‚   â”‚   â””â”€â”€ agent-backend.ts        # AgentBackend æ¥å£
â”‚   â””â”€â”€ editor-shell/               # é€šç”¨ Editor Shell (React)
â”‚       â”œâ”€â”€ App.tsx
â”‚       â”œâ”€â”€ components/
â”‚       â”‚   â”œâ”€â”€ ChatInput.tsx        # å¯¹è¯è¾“å…¥ (é€šç”¨)
â”‚       â”‚   â”œâ”€â”€ StreamingResponse.tsx # streaming å±•ç¤º (é€šç”¨)
â”‚       â”‚   â”œâ”€â”€ PermissionDialog.tsx  # tool å®¡æ‰¹ (é€šç”¨)
â”‚       â”‚   â””â”€â”€ ModeRenderer.tsx     # åŠ¨æ€åŠ è½½ mode æ¸²æŸ“ç»„ä»¶
â”‚       â”œâ”€â”€ hooks/
â”‚       â”‚   â””â”€â”€ useAgentConnection.ts
â”‚       â””â”€â”€ store/
â”‚           â””â”€â”€ editorStore.ts
â”‚
â”œâ”€â”€ modes/                          # Content Modes (å¯æ’æ‹”)
â”‚   â”œâ”€â”€ slide/
â”‚   â”‚   â”œâ”€â”€ index.ts                # SlideMode implements ContentMode
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”œâ”€â”€ SlideNavigator.tsx   # å·¦ä¾§å¤§çº²/ç¼©ç•¥å›¾
â”‚   â”‚   â”‚   â”œâ”€â”€ SlidePreview.tsx     # å³ä¾§ slide é¢„è§ˆ
â”‚   â”‚   â”‚   â””â”€â”€ SlideSelector.ts     # å…ƒç´ é€‰ä¸­é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ skill/                   # â† å®Œæ•´çš„ Claude Code Skill åŒ…
â”‚   â”‚   â”‚   â”‚                        #    å¯åŠ¨æ—¶å®‰è£…åˆ° workspace/.claude/skills/
â”‚   â”‚   â”‚   â”œâ”€â”€ SKILL.md             #    Skill å…¥å£ï¼šç”Ÿæˆè§„èŒƒ + ç¼–è¾‘åè®®
â”‚   â”‚   â”‚   â”œâ”€â”€ templates/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ themes/          #    CSS ä¸»é¢˜é¢„è®¾
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ layouts/         #    HTML å¸ƒå±€æ¨¡æ¿
â”‚   â”‚   â”‚   â”œâ”€â”€ references/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ slide-codegen-guide.md
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ design-principles.md
â”‚   â”‚   â”‚   â””â”€â”€ scripts/
â”‚   â”‚   â”‚       â”œâ”€â”€ validate-manifest.js
â”‚   â”‚   â”‚       â””â”€â”€ export-pdf.js
â”‚   â”‚   â””â”€â”€ file-convention.ts       # manifest.json + slides/ çº¦å®š
â”‚   â”‚
â”‚   â”œâ”€â”€ doc/                        # (æœªæ¥) â€” å„ mode åŒç†ï¼Œéƒ½å¸¦ç‹¬ç«‹ skill/
â”‚   â”œâ”€â”€ mindmap/                    # (æœªæ¥)
â”‚   â””â”€â”€ canvas/                     # (æœªæ¥)
â”‚
â”œâ”€â”€ backends/                       # Code Agent Backends (å¯æ’æ‹”)
â”‚   â”œâ”€â”€ claude-code/
â”‚   â”‚   â”œâ”€â”€ index.ts                # ClaudeCodeBackend implements AgentBackend
â”‚   â”‚   â”œâ”€â”€ spawner.ts              # spawn claude --sdk-url ...
â”‚   â”‚   â”œâ”€â”€ ndjson-parser.ts        # NDJSON è§£æ/åºåˆ—åŒ–
â”‚   â”‚   â””â”€â”€ protocol-adapter.ts     # NDJSON â†” æ ‡å‡†æ¶ˆæ¯
â”‚   â”‚
â”‚   â”œâ”€â”€ codex/                      # (æœªæ¥)
â”‚   â””â”€â”€ custom/                     # (æœªæ¥)
â”‚
â””â”€â”€ docs/
    â”œâ”€â”€ architecture.md
    â”œâ”€â”€ creating-modes.md           # å¦‚ä½•åˆ›å»ºæ–°çš„ Content Mode
    â”œâ”€â”€ creating-backends.md        # å¦‚ä½•æ¥å…¥æ–°çš„ Code Agent
    â””â”€â”€ protocol.md                 # å‚è€ƒ Companion WEBSOCKET_PROTOCOL_REVERSED.md
```

---

## 5. å¼€æ”¾é—®é¢˜

### ğŸ”´ å…³é”®é£é™©

#### 5.1 `--sdk-url` åè®®ç¨³å®šæ€§

è¿™æ˜¯ä¸€ä¸ªæœªå…¬å¼€çš„éšè— flagï¼ŒAnthropic å¯èƒ½éšæ—¶ä¿®æ”¹æˆ–ç§»é™¤ã€‚

ç¼“è§£æªæ–½ï¼š
- Backend å¯æ’æ‹”ï¼Œåè®®å˜åŒ–åªå½±å“ `backends/claude-code/`
- å¯†åˆ‡è·Ÿè¸ª Companion ç¤¾åŒºæ›´æ–°
- Companion 395+ stars + æ´»è·ƒç»´æŠ¤ï¼Œå½¢æˆç¤¾åŒºä¾èµ–ï¼ŒAnthropic ä¸å¤ªå¯èƒ½æ— æ›¿ä»£æ–¹æ¡ˆç›´æ¥ç æ‰

#### 5.2 è¿‡åº¦æŠ½è±¡å¯¼è‡´ MVP å»¶æœŸ

ç¼“è§£æªæ–½ï¼š**å…ˆ hardcode slide + claude-code è·‘é€šé—­ç¯ï¼Œå†æŠ½è±¡æ¥å£**ã€‚ç±»å‹å®šä¹‰å’Œç›®å½•ç»“æ„å¯ä»¥å…ˆå°±ä½ï¼Œä½†å®é™…çš„æ’ä»¶æ³¨å†Œæœºåˆ¶ä¸æ€¥ã€‚

### ğŸŸ¡ å¾…ç¡®è®¤

#### 5.3 æ˜¯å¦ fork/å¤ç”¨ Companion ä»£ç 

| æ–¹æ¡ˆ | ä¼˜ç‚¹ | ç¼ºç‚¹ |
|------|------|------|
| **A: ç›´æ¥ fork** | å¿«é€Ÿè·å¾—æˆç†Ÿé€šä¿¡å±‚ | éœ€å¤§å¹…é‡æ„ UIï¼Œå¯èƒ½ç»§æ‰¿ä¸éœ€è¦çš„å¤æ‚åº¦ |
| **B: æå–é€šä¿¡å±‚** | åªæ‹¿éœ€è¦çš„éƒ¨åˆ† | éœ€ç†è§£å’ŒæŠ½å–ï¼Œå·¥ä½œé‡ä¸­ç­‰ |
| **C: åªå‚è€ƒåè®®æ–‡æ¡£** | å®Œå…¨æŒæ§ | å·¥ä½œé‡æœ€å¤§ï¼Œå¯èƒ½è¸©é‡å¤çš„å‘ |

å»ºè®®ï¼š**æ–¹æ¡ˆ B** â€” æå– `claude-bridge` + `ndjson-parser` æ”¾å…¥ `backends/claude-code/`ã€‚

#### 5.4 Slide Mode èµ„äº§å¤ç”¨

Slide çš„ skill / æ¨¡æ¿ / ä¸»é¢˜æ˜¯å¤ç”¨ Tanka AI å·²æœ‰èµ„äº§ï¼Œè¿˜æ˜¯ç‹¬ç«‹å¼€å‘ï¼Ÿ

#### 5.5 UI ä¸Šä¸‹æ–‡æ³¨å…¥æ–¹å¼

- **æ–¹æ¡ˆ Aï¼šæ–‡æœ¬å‰ç¼€** â€” `[Context: Slide 3, selected: h1 "æŠ€æœ¯æ–¹æ¡ˆ"] æ”¹å¤§ä¸€ç‚¹`
- **æ–¹æ¡ˆ Bï¼šç»“æ„åŒ– JSON** â€” é€šè¿‡ CLAUDE.md æ•™ agent ç†è§£ JSON ä¸Šä¸‹æ–‡

å»ºè®®ï¼šMVP ç”¨æ–¹æ¡ˆ Aã€‚

#### 5.6 Codex Backend å¯è¡Œæ€§

Codex CLI æ˜¯å¦ä¹Ÿæ”¯æŒ `--sdk-url` ç±»ä¼¼çš„ WebSocket æ¨¡å¼ï¼Ÿéœ€è¦è°ƒç ”ã€‚

---

## 6. åˆ†é˜¶æ®µè®¡åˆ’

### Phase 1: MVP â€” Slide Mode + Claude Code

| æ¨¡å— | èŒƒå›´ |
|------|------|
| `core/server` | WebSocket åŒé€šé“ + æ¶ˆæ¯è·¯ç”± + file watcher + **skill-installer** |
| `core/editor-shell` | å¯¹è¯è¾“å…¥ + streaming + tool å®¡æ‰¹ + mode æ¸²æŸ“å™¨ |
| `modes/slide` | å¤§çº² + é¢„è§ˆ + å…ƒç´ é€‰ä¸­ + **å®Œæ•´ skill åŒ… (SKILL.md + templates + references)** |
| `backends/claude-code` | spawn + NDJSON åè®® + permission flow |
| `bin/pneuma` | CLI å¯åŠ¨å™¨ |

### Phase 2: æ‰“ç£¨ + æ¡†æ¶åŒ–

| æ¨¡å— | èŒƒå›´ |
|------|------|
| Slide å¢å¼º | ä¸»é¢˜ç³»ç»Ÿã€å¯¼å‡º PDF/HTMLã€æ¼”ç¤ºæ¨¡å¼ã€æ‹–æ‹½æ’åº |
| Session | `--resume` æ¢å¤ã€å¤š session |
| æ¡†æ¶ | Content Mode / Agent Backend æ’ä»¶æ³¨å†Œæœºåˆ¶æ­£å¼åŒ– |

### Phase 3: æ‰©å±•ç”Ÿæ€

| æ¨¡å— | èŒƒå›´ |
|------|------|
| Doc Mode | é•¿æ–‡æ¡£ç¼–è¾‘ |
| Mindmap Mode | æ€ç»´å¯¼å›¾ |
| Codex Backend | æ¥å…¥ Codex CLI |
| æ¨¡æ¿å¸‚åœº | å¯åˆ†äº«çš„ä¸»é¢˜å’Œæ¨¡æ¿åŒ… |

---

## 7. æˆåŠŸæ ‡å‡†

### MVP éªŒæ”¶

1. âœ… `pneuma slide` ä¸€é”®å¯åŠ¨ï¼Œspawn headless Claude Codeï¼Œæµè§ˆå™¨æ‰“å¼€ç¼–è¾‘å™¨
2. âœ… æµè§ˆå™¨è¾“å…¥"åšä¸€ä¸ª XX ä¸»é¢˜çš„ PPT"ï¼Œstreaming + slides ç”Ÿæˆ + å®æ—¶é¢„è§ˆ
3. âœ… é€‰ä¸­å…ƒç´  + è¾“å…¥æŒ‡ä»¤ï¼ŒClaude Code ç†è§£ä¸Šä¸‹æ–‡ï¼Œé¢„è§ˆå®æ—¶æ›´æ–°
4. âœ… ä½¿ç”¨ Claude Max è®¢é˜…ï¼Œé›¶é¢å¤–æˆæœ¬
5. âœ… é¦–ä¸ª streaming token < 3 ç§’

### æ¡†æ¶éªŒæ”¶

6. âœ… æ–°å¢ Content Mode åªéœ€å®ç° `ContentMode` æ¥å£ + UI ç»„ä»¶
7. âœ… æ–°å¢ Agent Backend åªéœ€å®ç° `AgentBackend` æ¥å£ + åè®®é€‚é…å™¨

---

## é™„å½• A: å‚è€ƒé¡¹ç›®

| é¡¹ç›® | å…³ç³» | å€Ÿé‰´ç‚¹ |
|------|------|--------|
| **[The-Vibe-Company/companion](https://github.com/The-Vibe-Company/companion)** | **æ ¸å¿ƒæŠ€æœ¯å‚è€ƒ** | `--sdk-url` é€†å‘åè®®ã€NDJSONã€session ç®¡ç†ã€permission flow |
| Slidev | Slide Mode å‚è€ƒ | æ–‡ä»¶æ ¼å¼ã€Vite HMR |
| reveal.js | Slide Mode å‚è€ƒ | slide ç»“æ„è§„èŒƒ |
| Gamma.app | äº§å“å‚è€ƒ | AI PPT äº¤äº’è®¾è®¡ |

## é™„å½• B: å‘½å

**Pneuma** (Ï€Î½Îµá¿¦Î¼Î±)

- å¸Œè…Šè¯­ï¼šçµé­‚ã€æ°”æ¯ã€ç”Ÿå‘½åŠ›ã€ç²¾ç¥
- è°éŸ³ï¼šç‰›é©¬ ğŸ‚ğŸ´
- å¯“æ„ï¼šä¸º Code Agent æ³¨å…¥çµé­‚ï¼Œè®© HTML å†…å®¹æ´»èµ·æ¥ï¼›ä¹Ÿè‡´æ•¬æ¯ä¸€ä¸ªç‰›é©¬å¼€å‘è€…